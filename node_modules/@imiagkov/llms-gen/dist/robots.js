import { createRequire } from "module";
import axios from "axios";
const require = createRequire(import.meta.url);
const robotsParser = require("robots-parser");
export async function fetchRobots(rootUrl, userAgent) {
    try {
        const robotsUrl = new URL("/robots.txt", rootUrl).toString();
        const res = await axios.get(robotsUrl, { timeout: 8000, validateStatus: () => true });
        const body = typeof res.data === "string" ? res.data : "";
        // âœ… Use CJS callable function via createRequire
        const parser = robotsParser(robotsUrl, body);
        // Some parser APIs aren't typed in d.ts
        const crawlDelay = parser.getCrawlDelay(userAgent) || parser.getCrawlDelay("*");
        const sitemaps = parser.getSitemaps?.() || [];
        return {
            isAllowed: (url, ua) => parser.isAllowed(url, ua) !== false,
            crawlDelay,
            sitemaps
        };
    }
    catch {
        return {
            isAllowed: () => true,
            crawlDelay: undefined,
            sitemaps: []
        };
    }
}
