import * as cheerio from "cheerio";
import { httpGet } from "./fetcher.js";
export async function fetchMeta(url, userAgent) {
    const res = await httpGet(url, userAgent);
    if (!res.ok || !res.data)
        return { url, score: 0 };
    const $ = cheerio.load(res.data);
    const title = ($("head > title").text() || "").trim() || undefined;
    const description = $('meta[name="description"]').attr("content") ||
        $('meta[property="og:description"]').attr("content") ||
        undefined;
    const h1 = $("h1").first().text().trim() || undefined;
    const canonical = $('link[rel="canonical"]').attr("href") || undefined;
    const lastModified = res.headers["last-modified"] || null;
    const etag = res.headers["etag"] || null;
    const score = (title ? 2 : 0) + (description ? 2 : 0) + (h1 ? 1 : 0);
    return { url, title, description, h1, canonical, lastModified, etag, score };
}
